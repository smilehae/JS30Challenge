<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Type Ahead ðŸ‘€</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <form class="search-form">
      <input type="text" class="search" placeholder="City or State" />
      <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
      </ul>
    </form>
    <script>
      const endpoint =
        "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";

      //ë¯¸í•´ì˜ ì‹œë„
      //  /   JSONì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ”, XMLHttpRequest(XHR) APIë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
      // const request = new XMLHttpRequest();
      // request.open("GET", endpoint);
      // request.responseType = "json";
      // request.send();
      // request.onload = function () {
      //   const cities = request.response;
      //   input.addEventListener("input", filterCities(cities, "New"));
      // };

      function filterCities(cities, str) {
        const listContainer = document.querySelector(".suggestions");
        const cityArr = Array.from(cities).filter(function (city) {
          return city["city"].includes(str) || city["state"].includes(str);
        });
        console.log(cityArr);
        const listTag = Array.from(document.querySelectorAll("li"));
        listTag.forEach((element) => {
          element.remove();
        });

        for (let i = 0; i < cityArr.length; i++) {
          const nameBlock = document.createElement("li");
          nameBlock.textContent = `${cityArr[i].city}, ${cityArr[i].state}`;
          listContainer.appendChild(nameBlock);
        }
      }
      /////////////////////////////////////////////////////////
      //ë‹µ ì°¸ê³ 
      //XMLHttpReqestì˜ ëŒ€ì²´ì œì¸ fetch APIë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.
      //jQueryì˜ ajaz()ì™€ ë‹¤ë¥¸ ì  : fetch()ì—ì„œ ë°˜í™˜ë˜ëŠ” promiseê°ì²´ëŠ” http errorì„ reject í•˜ì§€ ì•ŠìŒ. ëŒ€ì‹  ok ìƒíƒœê°€ falseë¡œ ëœ¬ë‹¤.
      //ë˜í•œ ì¿ í‚¤ë¥¼ ë³´ë‚´ê±°ë‚˜ ë°›ì§€ ì•ŠëŠ”ë‹¤.

      //fetch ì‚¬ìš© íë¦„ì€, íŠ¹ì • ì¸ìˆ˜ì˜ ê²½ë¡œì— ë”°ë¼ì„œ ê°€ì ¸ì˜¤ê³ , ì‘ë‹µì„ í¬í•¨í•˜ëŠ” ì•½ì†(response)ë¥¼ ë°˜í™˜í•˜ëŠ”ê²ƒ.
      const cities = [];
      fetch(endpoint)
        .then((blob) => blob.json())
        .then((data) => cities.push(...data));

      const input = document.querySelector(".search");
      input.addEventListener("input", function () {
        filterCities(cities, this.value);
      });
    </script>
  </body>
</html>
